import { GameId } from "@/types";
import { GAMES } from "@/utils/gameConfig";

export type Language = "ru" | "en";
export type LocalizedText = { ru: string; en: string };

export const localize = (value: LocalizedText, language: Language) => value[language];

type UiValue = string | ((params: Record<string, number | string>) => string);

const UI: Record<Language, Record<string, UiValue>> = {
  ru: {
    appName: "Awful Exercises",
    customQuestions: "Свои вопросы",
    sound: "Звук",
    soundOn: "Звук включен",
    soundOff: "Звук выключен",
    chooseExercise: "Выбрать упражнение",
    chooseExerciseTitle: "Выбрать упражнение",
    randomMode: "Случайный режим",
    randomModeTitle: "Случайный режим",
    reroll: "Перемешать",
    settings: "Настройки",
    gameOrganization: "Игры",
    gameOrder: "Порядок",
    gameTags: "Теги",
    moveUp: "Вверх",
    moveDown: "Вниз",
    longTest: "Длинный тест",
    longTestDescription: "Случайные вопросы из разных игр",
    stats: "Статистика",
    statsTitle: "Статистика",
    hotkeys: "Горячие клавиши: 1-4 выбор • P пауза • Esc выход",
    searchPlaceholder: "Поиск по названию или описанию",
    clear: "Очистить",
    noResults: "Ничего не найдено. Попробуйте другое слово.",
    questions: "Вопросов",
    difficulty: "Сложность",
    played: "Сыграно",
    accuracy: "Точность",
    lastResult: "Последний результат",
    customQuestionsCount: "Свои вопросы",
    totalScore: "Всего очков",
    games: "Игр",
    gamesPlayed: "Игр сыграно",
    bestStreak: "Лучшая серия",
    averageAccuracy: "Средняя точность",
    byGames: "По играм",
    resetStats: "Сбросить статистику",
    resetStatsConfirm: "Сбросить всю статистику?",
    gameOf: ({ current, total }) => `Игра ${current} из ${total}`,
    cancel: "Отмена",
    start: "Начать",
    loading: "Загрузка...",
    back: "Назад",
    mistakeReviewTitle: ({ count }) => `Разбор ошибок (${count})`,
    yourAnswer: "Ваш ответ",
    correctAnswer: "Правильный",
    reviewMistakes: "Посмотреть разбор →",
    tryAgain: "Попробовать снова",
    roundComplete: "Раунд завершён!",
    correctSummary: ({ correct, total, accuracy }) => `Правильно: ${correct} из ${total} (${accuracy}%)`,
    nextGame: ({ name }) => `Далее: ${name}`,
    mistakesCount: ({ count, label }) => `${count} ${label}`,
    mistakesLabel: ({ count }) => {
      const value = typeof count === "number" ? count : Number(count);
      if (!Number.isFinite(value)) return "ошибок";
      if (value % 10 === 1 && value % 100 !== 11) return "ошибка";
      if (value % 10 >= 2 && value % 10 <= 4 && (value % 100 < 10 || value % 100 >= 20)) return "ошибки";
      return "ошибок";
    },
    exit: "Выйти",
    again: "Ещё раз",
    next: "Следующая игра",
    pause: "Пауза",
    resume: "Продолжить",
    time: "Время",
    pointsPerCorrect: "За правильный ответ",
    questionCount: "Вопросов в тесте",
    seconds: "с",
    noQuestionsTitle: "Вопросы скоро появятся",
    noQuestionsHint: "Добавьте собственные вопросы в меню сверху.",
    source: "Источник",
    difficultyLabel: "Сложность",
    listView: "Список",
    gridView: "Плитка",
    uiLanguage: "Язык",
    english: "English",
    russian: "Русский",
    mistakes: "ошибки",
    pauseHint: "P — пауза",
    controlsHint: "1-4 — выбор ответа",
    notFoundTitle: "Страница не найдена",
    notFoundDescription: "Похоже, вы перешли по устаревшей ссылке.",
    goHome: "Вернуться на главную",
    errorTitle: "Что-то пошло не так",
    errorDescription: "Попробуйте перезапустить страницу или вернуться в меню.",
    retry: "Попробовать снова",
    imageSourceLabel: "Источник",
    customQuestionsTitle: ({ name }) => `Свои вопросы: ${name}`,
    customQuestionsModalTitle: "Свои вопросы",
    customQuestionsModalDescription: "Выбрать игру и добавить вопросы в одном стиле с базовыми заданиями.",
    close: "Закрыть",
    enableCustom: "Включить свои вопросы",
    customEnabled: "Свои вопросы включены",
    addAtLeastOne: "Добавьте хотя бы один вопрос",
    questionsList: ({ count }) => `Список вопросов (${count})`,
    emptyList: "Пока пусто.",
    delete: "Удалить",
    edit: "Редактировать",
    editing: "Редактируется",
    newQuestion: "Новый вопрос",
    questionText: "Текст вопроса",
    helperOptional: "Подсказка (опционально)",
    explanation: "Объяснение ошибки (показывается после ответа)",
    preview: "Превью",
    correctAnswerLabel: "Правильный ответ",
    optionLabel: ({ index }) => `Вариант ${index}`,
    addQuestion: "Добавить вопрос",
    saveChanges: "Сохранить изменения",
    cancelEdit: "Отменить",
    home: "Главная",
    gamesNav: "Игры",
    randomNav: "Случайно",
    searchLabel: "Поиск упражнений",
    generated: "генеративные",
    addQuestions: "Добавить вопросы",
    optionsTitle: "Варианты",
    addOption: "Добавить",
    optionText: "Текст варианта",
    sizeLabel: "Размер",
    weightLabel: "Вес",
    fontName: "Название шрифта",
    fontExample: "Шрифт (например, Manrope)",
    imageUrl: "URL изображения",
    altText: "Alt-текст",
    sourceOptional: "Источник (опционально)",
    previewText: "Текст превью",
    sampleText: "Текст образца",
    customQuestionsDescription: "Создайте вопросы, подсказки и объяснения для режима игры.",
    customQuestionsEmptyTitle: "Свои вопросы не найдены",
    customQuestionsEmptyHint: "Добавьте вопросы в редакторе, чтобы играть в своём режиме.",
    optionsCount: ({ count }) => `Вариантов: ${count}`,
    resultGreat: "Отлично",
    resultGood: "Хорошо",
    resultOk: "Неплохо",
    scoreLabel: "Очки",
    streakLabel: "Серия",
    livesLabel: "Жизни",
    timeRoundLabel: "Время на раунд, секунд",
    noQuestionsLeft: "Вопросы закончились!",
    repeatMode: "Повторы",
    noRepeats: "Без повторов",
    allowRepeats: "Повторы разрешены",
    backgroundAnimation: "Фон",
    timedMode: "Таймер",
    hotkeysTitle: "Горячие клавиши",
    hotkeyStart: "Space — старт",
    hotkeyPause: "P — пауза",
    hotkeySkip: "S — пропуск",
    hotkeyShuffle: "R — случайно",
    hotkeyAnswer: "1-6 — ответ",
    license: "Лицензия",
    github: "GitHub",
    feedback: "Обратная связь",
    skip: "Пропустить",
    reportQuestion: "Пожаловаться",
    reportIssueTitle: "Сообщить об ошибке",
    reportPlaceholder: "Опиши проблему в вопросе или ответе",
    sendEmail: "Почта",
    hint: "Подсказка",
    on: "Вкл",
    off: "Выкл",
    tagAll: "Все",
    tagDesign: "Дизайн",
    tagInterface: "Интерфейс",
    tagColor: "Цвет",
    tagTypography: "Типографика",
    tagLayout: "Композиция",
    tagPhoto: "Фото",
    tagAccessibility: "Доступность",
    tagTheory: "Теория",
    favorites: "Избранное",
    sort: "Сортировка",
    sortDefault: "По умолчанию",
    sortName: "По названию",
    sortPlayed: "По сыгранным",
  },
  en: {
    appName: "Awful Exercises",
    customQuestions: "Custom questions",
    sound: "Sound",
    soundOn: "Sound on",
    soundOff: "Sound off",
    chooseExercise: "Choose exercise",
    chooseExerciseTitle: "Choose exercise",
    randomMode: "Random mode",
    randomModeTitle: "Random mode",
    reroll: "Reroll",
    settings: "Settings",
    gameOrganization: "Games",
    gameOrder: "Order",
    gameTags: "Tags",
    moveUp: "Up",
    moveDown: "Down",
    longTest: "Long test",
    longTestDescription: "Random questions from multiple games",
    stats: "Stats",
    statsTitle: "Statistics",
    hotkeys: "Hotkeys: 1-4 select • P pause • Esc exit",
    searchPlaceholder: "Search by name or description",
    clear: "Clear",
    noResults: "No results. Try another keyword.",
    questions: "Questions",
    difficulty: "Difficulty",
    played: "Played",
    accuracy: "Accuracy",
    lastResult: "Last result",
    customQuestionsCount: "Custom questions",
    totalScore: "Total score",
    games: "Games",
    gamesPlayed: "Games played",
    bestStreak: "Best streak",
    averageAccuracy: "Average accuracy",
    byGames: "By game",
    resetStats: "Reset stats",
    resetStatsConfirm: "Reset all statistics?",
    gameOf: ({ current, total }) => `Game ${current} of ${total}`,
    cancel: "Cancel",
    start: "Start",
    loading: "Loading...",
    back: "Back",
    mistakeReviewTitle: ({ count }) => `Mistake review (${count})`,
    yourAnswer: "Your answer",
    correctAnswer: "Correct",
    reviewMistakes: "View review →",
    tryAgain: "Try again",
    roundComplete: "Round complete!",
    correctSummary: ({ correct, total, accuracy }) => `Correct: ${correct} of ${total} (${accuracy}%)`,
    nextGame: ({ name }) => `Next: ${name}`,
    mistakesCount: ({ count }) => `${count} mistakes`,
    mistakesLabel: ({ count }) => (count === 1 ? "mistake" : "mistakes"),
    exit: "Exit",
    again: "Again",
    next: "Next game",
    pause: "Paused",
    resume: "Resume",
    time: "Time",
    pointsPerCorrect: "Per correct answer",
    questionCount: "Questions in test",
    seconds: "s",
    noQuestionsTitle: "More questions coming soon",
    noQuestionsHint: "Add your own questions in the top menu.",
    source: "Source",
    difficultyLabel: "Difficulty",
    listView: "List",
    gridView: "Grid",
    uiLanguage: "Language",
    english: "English",
    russian: "Русский",
    mistakes: "mistakes",
    pauseHint: "P — pause",
    controlsHint: "1-4 — select",
    notFoundTitle: "Page not found",
    notFoundDescription: "Looks like the link is outdated.",
    goHome: "Back to home",
    errorTitle: "Something went wrong",
    errorDescription: "Try reloading the page or return to the menu.",
    retry: "Try again",
    imageSourceLabel: "Source",
    customQuestionsTitle: ({ name }) => `Custom questions: ${name}`,
    customQuestionsModalTitle: "Custom questions",
    customQuestionsModalDescription: "Pick a game and add questions in the same style as the defaults.",
    close: "Close",
    enableCustom: "Enable custom questions",
    customEnabled: "Custom questions enabled",
    addAtLeastOne: "Add at least one question",
    questionsList: ({ count }) => `Questions (${count})`,
    emptyList: "Nothing here yet.",
    delete: "Delete",
    edit: "Edit",
    editing: "Editing",
    newQuestion: "New question",
    questionText: "Question text",
    helperOptional: "Hint (optional)",
    explanation: "Explanation (shown after answer)",
    preview: "Preview",
    correctAnswerLabel: "Correct answer",
    optionLabel: ({ index }) => `Option ${index}`,
    addQuestion: "Add question",
    saveChanges: "Save changes",
    cancelEdit: "Cancel",
    home: "Home",
    gamesNav: "Games",
    randomNav: "Random",
    searchLabel: "Search exercises",
    generated: "generated",
    addQuestions: "Add questions",
    optionsTitle: "Options",
    addOption: "Add",
    optionText: "Option text",
    sizeLabel: "Size",
    weightLabel: "Weight",
    fontName: "Font name",
    fontExample: "Font (e.g. Manrope)",
    imageUrl: "Image URL",
    altText: "Alt text",
    sourceOptional: "Source (optional)",
    previewText: "Preview text",
    sampleText: "Sample text",
    customQuestionsDescription: "Create questions, hints, and explanations for the custom mode.",
    customQuestionsEmptyTitle: "No custom questions yet",
    customQuestionsEmptyHint: "Add questions in the editor to play your own set.",
    optionsCount: ({ count }) => `Options: ${count}`,
    resultGreat: "Great",
    resultGood: "Good",
    resultOk: "Not bad",
    scoreLabel: "Score",
    streakLabel: "Streak",
    livesLabel: "Lives",
    timeRoundLabel: "Round time, seconds",
    noQuestionsLeft: "No questions left!",
    repeatMode: "Repeats",
    noRepeats: "No repeats",
    allowRepeats: "Repeats allowed",
    backgroundAnimation: "Background",
    timedMode: "Timer",
    hotkeysTitle: "Hotkeys",
    hotkeyStart: "Space — start",
    hotkeyPause: "P — pause",
    hotkeySkip: "S — skip",
    hotkeyShuffle: "R — reroll",
    hotkeyAnswer: "1-6 — answer",
    license: "License",
    github: "GitHub",
    feedback: "Feedback",
    skip: "Skip",
    reportQuestion: "Report",
    reportIssueTitle: "Report an issue",
    reportPlaceholder: "Describe the issue in the question or answer",
    sendEmail: "Email",
    hint: "Hint",
    on: "On",
    off: "Off",
    tagAll: "All",
    tagDesign: "Design",
    tagInterface: "Interface",
    tagColor: "Color",
    tagTypography: "Typography",
    tagLayout: "Layout",
    tagPhoto: "Photo",
    tagAccessibility: "Accessibility",
    tagTheory: "Theory",
    favorites: "Favorites",
    sort: "Sort",
    sortDefault: "Default",
    sortName: "Name",
    sortPlayed: "Played",
  },
};

const GAME_LABELS_EN: Record<GameId, { name: string; description: string }> = {
  "color-compare": {
    name: "Compare Colors",
    description: "Find the brighter, darker, or more saturated color",
  },
  "font-size": {
    name: "Font Size",
    description: "Guess the font size in pixels",
  },
  "font-weight": {
    name: "Font Weight",
    description: "Pick the lightest or boldest weight",
  },
  "guess-font": {
    name: "Guess the Font",
    description: "Identify the font name",
  },
  "color-params": {
    name: "Color Parameters",
    description: "Compare HSL parameters",
  },
  "color-temperature": {
    name: "Color Temperature",
    description: "Pick warm vs cool hue",
  },
  accessibility: {
    name: "Accessibility",
    description: "Check text readability by WCAG",
  },
  "palette-error": {
    name: "Palette Error",
    description: "Find the color that doesn't belong",
  },
  "size-sequence": {
    name: "Type Scale",
    description: "Find the error in the size sequence",
  },
  complementary: {
    name: "Complementary",
    description: "Pick complementary or split-complementary",
  },
  "guess-hex": {
    name: "Guess HEX",
    description: "Identify the color HEX code",
  },
  "guess-params": {
    name: "Guess HSL",
    description: "Estimate H, S, L values",
  },
  quiz: {
    name: "Quiz",
    description: "Theory quiz on color and type",
  },
  "theme-analog": {
    name: "Theme Analog",
    description: "Adapt a color for another theme",
  },
  "artist-guess": {
    name: "Who Painted",
    description: "Identify the artist from the image",
  },
  "style-guess": {
    name: "Style Guess",
    description: "Identify the art style",
  },
  "image-size": {
    name: "Image Size",
    description: "Estimate size by sight",
  },
  "image-format": {
    name: "Aspect Ratio",
    description: "Identify the image format",
  },
  "color-eye": {
    name: "Color Match",
    description: "Match the sample color",
  },
  "color-wheel": {
    name: "Color Wheel",
    description: "Find complementary or analog color",
  },
  "film-type": {
    name: "Film Profile",
    description: "Identify the film profile from a color chart",
  },
  "composition-technique": {
    name: "Composition",
    description: "Identify the technique from a diagram",
  },
  "focal-length": {
    name: "Focal Length",
    description: "Match focal length to field of view",
  },
  "wcag-issue": {
    name: "WCAG Issue",
    description: "Spot an accessibility issue",
  },
  "button-color": {
    name: "Button Color",
    description: "Choose a contrasty button color",
  },
  "font-size-choice": {
    name: "UI Font Size",
    description: "Choose a readable UI font size",
  },
  "layout-error": {
    name: "Layout Error",
    description: "Find the layout problem",
  },
  "palette-from-photo": {
    name: "Palette Match",
    description: "Pick the palette that matches the image",
  },
  "long-test": {
    name: "Long test",
    description: "Mixed round with questions from different games",
  },
};

export const t = (lang: Language, key: string, params: Record<string, number | string> = {}) => {
  const value = UI[lang][key];
  if (typeof value === "function") {
    return value(params);
  }
  return value ?? UI.ru[key] ?? key;
};

export const getGameLabel = (gameId: GameId, lang: Language) => {
  if (lang === "en" && GAME_LABELS_EN[gameId]) {
    return GAME_LABELS_EN[gameId];
  }
  return { name: GAMES[gameId].name, description: GAMES[gameId].description };
};
